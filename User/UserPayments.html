<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Payments</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <style>
        .navbar, footer {
            background-color: rgba(255, 255, 255, 0.85) !important;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            padding-top: 1rem;
            padding-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.8rem;
            color: #007bff !important;
        }

        .nav-link {
            font-weight: 500;
            transition: color 0.3s ease, transform 0.2s ease, background-color 0.3s ease;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            margin-left: 0.25rem;
            margin-right: 0.25rem;
            color: #343a40 !important;
        }

        .nav-link:hover {
            color: #0056b3 !important;
            background-color: rgba(0, 123, 255, 0.08);
            transform: translateY(-2px);
        }

        .nav-link.active {
            color: #fff !important;
            background-color: #007bff;
            border-bottom: none;
        }

  .full-page-background {
            background: linear-gradient(135deg, #e0f7fa, #c5e1a5);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

  /* Darker borders and shadow for tables and forms */
  table, th, td {
    border: 1px solid #dee2e6 !important;
  }
  table {
    box-shadow: none;
  }
  form {
    box-shadow: none;
    border: 1px solid #ced4da;
    padding: 1rem;
    border-radius: 0.375rem;
  }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #212529;
    }

    h2 {
      font-weight: 700;
      font-size: 2.5rem;
      color: #000000;
      text-transform: uppercase;
      margin-bottom: 1rem;
    }

    h4 {
      font-weight: 600;
      font-size: 1.75rem;
      color: #000000;
      margin-bottom: 1.5rem;
      text-transform: uppercase;
    }

  /* Fix button logo alignment and adjust button size and text */
  .btn-lg {
    font-size: 1.1rem;
    padding-left: 0.75rem;
    padding-right: 0.75rem;
    line-height: 1.5;
    display: inline-flex;
    align-items: center;
  }
  .btn-lg img {
    height: 24px;
    width: 24px;
    margin-right: 6px;
    vertical-align: middle;
  }
  </style>
</head>

<body>
<div class="full-page-background">
    <!--Begining of Page-->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="UserDashboard.html">My Auto Insurance</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="UserDashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="my-profile.html">My Profile</a></li>
                    <li class="nav-item"><a class="nav-link" href="UserPolicy.html">My Policies</a></li>
                    <li class="nav-item"><a class="nav-link" href="UserClaims.html">Claims</a></li>
                    <li class="nav-item"><a class="nav-link active" href="UserPayments.html">Payments</a></li>
                    <li class="nav-item"><a class="nav-link" href="UserSupport.html">Support</a></li>
                    <li class="nav-item"><a class="nav-link" href="UserHelp.html">Help</a></li>
                    <li class="nav-item"><a class="nav-link" href="../index.html">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>
<!-- Page Title -->
<div class="container mt-4">
    <h2 class="text-center mb-4" class="fw-bold">Payment Checkout</h2>

<!--Payment Details-->

  <!-- Removed separate policyDetailsForm -->

  <div class="container mt-5 d-flex flex-wrap justify-content-center gap-3">
  <h4 class="fw-bold w-100 mb-4 text-center">Choose Method</h4>

  <button type="button" class="btn btn-primary btn-lg d-flex align-items-center gap-2 px-4" onclick="showForm('card')">
      <img src="../Images/mastercard_logo.jfif" alt="Card Payment" width="30" height="30" class=""> Card
  </button>

  <button type="button" class="btn btn-dark btn-lg d-flex align-items-center gap-2 px-4" onclick="showForm('upi')">
      <img src="../Images/upi_logo.png" alt="UPI Payment" width="30" height="30" class=""> UPI
  </button>
</div>


    <!--CARD-->

    <div id="cardForm" class="mt-4 d-none">
      <div class="card mb-4 shadow-lg">
        <div class="card-header bg-success text-white"><h5>Enter Card Details</h5></div>
        <div class="card-body">
          <form id="cardPaymentForm">
              <div class="row mb-3 justify-content-center">
                <div class="col-md-6">
                  <label for="transactionIdCard" class="form-label">Transaction ID</label>
                  <input type="text" class="form-control border border-primary" id="transactionIdCard" readonly />
                </div>
              </div>
              <div class="row mb-3 justify-content-center">
                <div class="col-md-6">
                  <label for="policyNumberCard" class="form-label">Policy Number</label>
                  <input type="text" class="form-control border border-primary" id="policyNumberCard" placeholder="Enter Policy Number" required />
                </div>
                <div class="col-md-6">
                  <label for="policyHolderNameCard" class="form-label">Policy Holder Name</label>
                  <input type="text" class="form-control border border-primary" id="policyHolderNameCard" placeholder="Enter Policy Holder Name" required />
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-md-6">
                  <label for="cardNumber" class="form-label">Card Number</label>
                  <input type="text" class="form-control border border-primary" id="cardNumber" maxlength="19" placeholder="1234 5678 9012 3456" required />
                </div>
                <div class="col-md-6">
                  <label for="cardHolderName" class="form-label">Card Holder Name</label>
                  <input type="text" class="form-control border border-primary" id="cardHolderName" placeholder="John Doe" required />
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-md-3">
                  <label for="expiryDate" class="form-label">Expiration Date</label>
                  <input type="month" class="form-control border border-primary" id="expiryDate" required />
                </div>
                <div class="col-md-3">
                  <label for="cvv" class="form-label">CVV</label>
                  <input type="password" class="form-control border border-primary" id="cvv" maxlength="4" placeholder="123" required />
                </div>
                <div class="col-md-3">
                  <label for="paymentDateCard" class="form-label">Payment Date</label>
                  <input type="date" class="form-control border border-primary" id="paymentDateCard" readonly />
                </div>
                <div class="col-md-3">
                  <label for="paymentAmount" class="form-label">Amount Paid</label>
                  <input type="number" class="form-control border border-primary" id="paymentAmount" required />
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-md-6">
                  <label for="paymentMode" class="form-label">Payment Mode</label>
                  <select class="form-select border border-primary" id="paymentMode" required>
                    <option value="">Select</option>
                    <option>Credit Card</option>
                    <option>Debit Card</option>
                    <option>Net Banking</option>
                  </select>
                </div>
              </div>
              <button type="submit" class="btn btn-success d-block mx-auto px-4">Pay</button>
          </form>
        </div>
    </div>
  </div>


  
  <!--UPI-->

<div id="upiForm" class="mt-4 d-none">
  <div class="card mb-4 shadow-lg">
    <div class="card-header bg-warning text-dark"><h5>Enter UPI Details</h5></div>
    <div class="card-body">
          <form id="upiPaymentForm">
              <div class="row mb-3 justify-content-center">
                <div class="col-md-6">
                  <label for="transactionIdUpi" class="form-label">Transaction ID</label>
                  <input type="text" class="form-control border border-primary" id="transactionIdUpi" readonly />
                </div>
              </div>
              <div class="row mb-3 justify-content-center">
                <div class="col-md-6">
                  <label for="policyNumberUpi" class="form-label">Policy Number</label>
                  <input type="text" class="form-control border border-primary" id="policyNumberUpi" placeholder="Enter Policy Number" required />
                </div>
                <div class="col-md-6">
                  <label for="policyHolderNameUpi" class="form-label">Policy Holder Name</label>
                  <input type="text" class="form-control border border-primary" id="policyHolderNameUpi" placeholder="Enter Policy Holder Name" required />
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-md-4">
                  <label for="paymentDateUpi" class="form-label">Payment Date</label>
                  <input type="date" class="form-control border border-primary" id="paymentDateUpi" readonly />
                </div>
                <div class="col-md-4">
                  <label for="upiId" class="form-label">UPI ID</label>
                  <input type="text" class="form-control border border-primary" id="upiId" placeholder="Abcd@12345" autocomplete="off" required />
                </div>
                <div class="col-md-4">
                  <label for="upiAmount" class="form-label">Amount Paid</label>
                  <input type="number" class="form-control border border-primary" id="upiAmount" autocomplete="off" required />
                </div>
              </div>
              <button type="submit" class="btn btn-success d-block mx-auto px-4">Pay</button>
          </form>
    </div>
</div>
</div>

<!--Jquery for dynamically selecting payment option-->
<script>
    function showForm(method) {
        document.getElementById("cardForm").classList.add("d-none");
        document.getElementById("upiForm").classList.add("d-none");

        if (method === "card") {
            document.getElementById("cardForm").classList.remove("d-none");
        } else if (method === "upi") {
            document.getElementById("upiForm").classList.remove("d-none");
        }
    }
</script>

<!-- Payments Record Table -->
<div class="card mt-5">
  <div class="card-header bg-primary text-dark"><h5>Payment History</h5></div>
  <div class="card-body">
  <table class="table table-bordered table-striped" id="paymentTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Transaction ID</th>
          <th>Policy Number</th>
          <th>Name</th>
          <th>Date</th>
          <th>Amount</th>
          <th>Mode</th>
          <th>Processing Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="paymentTableBody">
        <tr id="noPaymentsRow">
          <td colspan="9" class="text-center text-muted">No payments made yet</td>
        </tr>
      </tbody>
      <tbody>
        <!-- Dynamic Rows -->
      </tbody>
    </table>
  </div>
</div>

<!--Generate Reciept Button-->

<div class="text-end mt-2 mb-4">
  <button type="button" class="btn btn-danger" onclick="generatePDF()">Generate Receipt</button>
</div>

<!-- Include jsPDF Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

<script>
  function generatePDF() {
    const { jsPDF } = window.jspdf; // Correctly define jsPDF
    let doc = new jsPDF();

    doc.setFontSize(18);
    doc.text("Payment Summary", 20, 20);
    doc.setFontSize(12);
    doc.text("Auto Insurance - Payment Record", 20, 30);

    let rows = [];
    document.querySelectorAll("#paymentTable tbody tr").forEach((tr, index) => {
            let row = [index + 1];
            // Extract all td except the last one (actions)
            let tds = tr.querySelectorAll("td");
            for (let i = 1; i < tds.length - 2; i++) {
                row.push(tds[i].innerText);
            }
            // Add processing status column value
            row.push(tds[tds.length - 2].innerText);
            rows.push(row);
    });

    if (rows.length === 0) {
        alert("No payments available to generate a receipt.");
        return;
    }

    // Ensure autoTable is properly loaded
    if (typeof doc.autoTable !== "function") {
        alert("Error: autoTable function is not recognized. Please check the autoTable library.");
        return;
    }

    doc.autoTable({
        startY: 40,
        head: [["#", "Transaction ID", "Policy Number", "Name", "Date", "Amount", "Mode", "Processing Status"]],
        body: rows
    });

    doc.save("Payment_Summary.pdf");
}
</script>



<!--JQUERY SCRIPT-->

<!-- jQuery Script to Handle Empty Table Message -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function () {
        var count = 1; // Row count for numbering

        // Set current date as default for payment date fields and make them readonly
        var today = new Date().toISOString().split('T')[0];
        $("#paymentDateCard").val(today);
        $("#paymentDateUpi").val(today);

        // Function to generate a unique transaction ID serially
        function generateTransactionIdSerial(count) {
            return 'TXN-' + String(count).padStart(4, '0');
        }

        // Set transaction IDs when forms are shown
        function setTransactionIds() {
            $("#transactionIdCard").val(generateTransactionIdSerial(count));
            $("#transactionIdUpi").val(generateTransactionIdSerial(count));
        }

        // Call setTransactionIds when payment method is selected
        window.showForm = function(method) {
            document.getElementById("cardForm").classList.add("d-none");
            document.getElementById("upiForm").classList.add("d-none");

            if (method === "card") {
                document.getElementById("cardForm").classList.remove("d-none");
            } else if (method === "upi") {
                document.getElementById("upiForm").classList.remove("d-none");
            }
            setTransactionIds();
        };

        $("#cardPaymentForm").submit(function (event) {
            event.preventDefault(); // Prevent form submission from refreshing the page

            // Get values from form inputs
            var transactionId = $("#transactionIdCard").val();
            var cardNumber = $("#cardNumber").val();
            var cardHolderName = $("#cardHolderName").val();
            var expiryDate = $("#expiryDate").val();
            var cvv = $("#cvv").val();
            var paymentDateCard = $("#paymentDateCard").val();
            var amountPaid = $("#paymentAmount").val();
            var paymentMode = $("#paymentMode").val();

            var policyNumber = $("#policyNumberCard").val();
            var policyHolderName = $("#policyHolderNameCard").val();

            // Validate inputs (ensure no fields are empty)
            if (transactionId && cardNumber && cardHolderName && expiryDate && cvv && paymentDateCard && amountPaid && paymentMode && policyNumber && policyHolderName) {
                // Remove "No payments made yet" message if present
                $("#noPaymentsRow").remove();

                // Append new payment entry
            var newRow = `<tr>
                <td>${count}</td>
                <td class="text-center"><span class="badge bg-danger text-white fw-bold">${transactionId}</span></td>
                <td>${policyNumber}</td>
                <td>${policyHolderName}</td>
                <td>${paymentDateCard}</td>
                <td>${amountPaid}</td>
                <td>${paymentMode}</td>
                <td>Pending</td>
                <td><button class="btn btn-danger btn-sm delete-btn">Delete</button></td>
            </tr>`;

              $("#paymentTableBody").append(newRow);
              count++; // Increment row counter

              // Clear form fields after submission
                $("#cardPaymentForm")[0].reset();
                // Reset payment date to today after form reset
                $("#paymentDateCard").val(today);
                setTransactionIds();
                count++; // Increment row counter
            } else {
                alert("Please fill all fields before submitting.");
            }
        });

        $("#upiPaymentForm").submit(function (event) {
            event.preventDefault();

            var transactionId = $("#transactionIdUpi").val();
            var policyNumber = $("#policyNumberUpi").val();
            var paymentName = $("#policyHolderNameUpi").val();
            var paymentDateUpi = $("#paymentDateUpi").val();
            var upiId = $("#upiId").val();
            var upiAmount = $("#upiAmount").val();

            if (transactionId && policyNumber && paymentName && paymentDateUpi && upiId && upiAmount) {
                $("#noPaymentsRow").remove();

            var newRow = `<tr>
                <td>${count}</td>
                <td class="text-center"><span class="badge bg-danger text-white fw-bold">${transactionId}</span></td>
                <td>${policyNumber}</td>
                <td>${paymentName}</td>
                <td>${paymentDateUpi}</td>
                <td>${upiAmount}</td>
                <td>UPI</td>
                <td>Pending</td>
                <td><button class="btn btn-danger btn-sm delete-btn">Delete</button></td>
            </tr>`;

              $("#paymentTableBody").append(newRow);
              count++;

                $("#upiPaymentForm")[0].reset();
                // Reset payment date to today after form reset
                $("#paymentDateUpi").val(today);
                setTransactionIds();
                count++; // Increment row counter
            } else {
                alert("Please fill all fields before submitting.");
            }
        });

      // Event listener for delete button
      $(document).on("click", ".delete-btn", function () {
          $(this).closest("tr").remove();

          // If table is empty after deletion, restore "No payments made yet"
          if ($("#paymentTableBody tr").length === 0) {
              $("#paymentTableBody").append('<tr id="noPaymentsRow"><td colspan="9" class="text-center text-muted">No payments made yet</td></tr>');
          }
      });
  });
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
